<!DOCTYPE html>
<<<<<<< HEAD
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinMint ç®¡ç†é¢æ¿</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .main-content {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .sidebar {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            height: fit-content;
        }

        .content-area {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }

        .nav-item {
            padding: 15px;
            margin: 10px 0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 500;
        }

        .nav-item:hover {
            background: #f8fafc;
            transform: translateX(5px);
        }

        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .nav-item .icon {
            font-size: 1.2em;
        }

        .editor-frame {
            width: 100%;
            height: 600px;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
        }

        .toolbar {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            padding: 15px;
            background: #f8fafc;
            border-radius: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }

        .btn-warning {
            background: linear-gradient(135deg, #ed8936 0%, #dd6b20 100%);
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .status-bar {
            background: #edf2f7;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e53e3e;
        }

        .status-dot.connected {
            background: #48bb78;
            animation: pulse 2s infinite;
        }

        .status-dot.deploying {
            background: #ed8936;
            animation: spin 1s linear infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .deploy-log {
            background: #1a202c;
            color: #e2e8f0;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            max-height: 200px;
            overflow-y: auto;
            margin-top: 15px;
            display: none;
        }

        .deploy-log.show {
            display: block;
        }

        .log-line {
            margin-bottom: 3px;
        }

        .log-success { color: #68d391; }
        .log-error { color: #fc8181; }
        .log-info { color: #63b3ed; }

        .config-form {
            display: none;
        }

        .config-form.active {
            display: block;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #2d3748;
        }

        .form-group input, .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 14px;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸš€ CoinMint ç®¡ç†é¢æ¿</h1>
            <p>å¯è§†åŒ–ç¼–è¾‘ + ä¸€é”®éƒ¨ç½²</p>
        </div>

        <div class="main-content">
            <!-- ä¾§è¾¹æ  -->
            <div class="sidebar">
                <h3 style="margin-bottom: 20px; color: #2d3748;">åŠŸèƒ½èœå•</h3>
                
                <div class="nav-item active" onclick="showEditor()">
                    <span class="icon">âœï¸</span>
                    <span>å¯è§†åŒ–ç¼–è¾‘</span>
                </div>
                
                <div class="nav-item" onclick="showDeploy()">
                    <span class="icon">ğŸš€</span>
                    <span>éƒ¨ç½²è®¾ç½®</span>
                </div>
                
                <div class="nav-item" onclick="window.open('../index.html', '_blank')">
                    <span class="icon">ğŸŒ</span>
                    <span>æŸ¥çœ‹ç½‘ç«™</span>
                </div>
                
                <div class="nav-item" onclick="showHelp()">
                    <span class="icon">â“</span>
                    <span>ä½¿ç”¨å¸®åŠ©</span>
                </div>
            </div>

            <!-- ä¸»å†…å®¹åŒº -->
            <div class="content-area">
                <!-- ç¼–è¾‘å™¨åŒºåŸŸ -->
                <div id="editor-area">
                    <div class="status-bar">
                        <div class="status-indicator">
                            <div class="status-dot" id="status-dot"></div>
                            <span id="status-text">å°±ç»ª</span>
                        </div>
                        <div>
                            <span id="changes-count">0</span> é¡¹ä¿®æ”¹å¾…å‘å¸ƒ
                        </div>
                    </div>

                    <div class="toolbar">
                        <button class="btn btn-primary" onclick="startEditing()">
                            âœï¸ å¼€å§‹ç¼–è¾‘
                        </button>
                        <button class="btn btn-warning" onclick="previewChanges()" id="preview-btn" disabled>
                            ğŸ‘ï¸ é¢„è§ˆä¿®æ”¹
                        </button>
                        <button class="btn btn-success" onclick="publishChanges()" id="publish-btn" disabled>
                            ğŸ“¤ å‘å¸ƒæ›´æ–°
                        </button>
                        <button class="btn" onclick="resetChanges()" id="reset-btn" disabled>
                            ğŸ”„ é‡ç½®ä¿®æ”¹
                        </button>
                    </div>

                    <iframe src="../index.html" class="editor-frame" id="editor-frame"></iframe>
                    
                    <div class="deploy-log" id="deploy-log"></div>
                </div>

                <!-- éƒ¨ç½²é…ç½®åŒºåŸŸ -->
                <div id="deploy-area" style="display: none;">
                    <h3>éƒ¨ç½²é…ç½®</h3>
                    <p style="margin-bottom: 20px; color: #718096;">é…ç½®éƒ¨ç½²æœåŠ¡ï¼Œå®ç°ä¸€é”®å‘å¸ƒåˆ°äº‘ç«¯</p>
                    
                    <div class="form-group">
                        <label>éƒ¨ç½²å¹³å°</label>
                        <select id="deploy-platform" onchange="updateDeployForm()">
                            <option value="">é€‰æ‹©éƒ¨ç½²å¹³å°</option>
                            <option value="netlify">Netlify (æ¨è)</option>
                            <option value="github">GitHub Pages</option>
                            <option value="vercel">Vercel</option>
                        </select>
                    </div>
                    
                    <div id="deploy-form"></div>
                    
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" onclick="saveDeployConfig()">
                            ğŸ’¾ ä¿å­˜é…ç½®
                        </button>
                        <button class="btn btn-warning" onclick="testConnection()">
                            ğŸ”— æµ‹è¯•è¿æ¥
                        </button>
                    </div>
                </div>

                <!-- å¸®åŠ©åŒºåŸŸ -->
                <div id="help-area" style="display: none;">
                    <h3>ä½¿ç”¨å¸®åŠ©</h3>
                    <div style="line-height: 1.6; color: #4a5568;">
                        <h4 style="margin: 20px 0 10px 0;">ğŸ“ å¦‚ä½•ç¼–è¾‘</h4>
                        <p>1. ç‚¹å‡»"å¼€å§‹ç¼–è¾‘"æŒ‰é’®</p>
                        <p>2. åœ¨é¢„è§ˆçª—å£ä¸­ç‚¹å‡»ä»»æ„æ–‡å­—è¿›è¡Œç¼–è¾‘</p>
                        <p>3. ç¼–è¾‘å®Œæˆåç‚¹å‡»"å‘å¸ƒæ›´æ–°"</p>
                        
                        <h4 style="margin: 20px 0 10px 0;">ğŸš€ å¦‚ä½•éƒ¨ç½²</h4>
                        <p>1. åœ¨"éƒ¨ç½²è®¾ç½®"ä¸­é€‰æ‹©å¹³å°</p>
                        <p>2. å¡«å†™ç›¸åº”çš„é…ç½®ä¿¡æ¯</p>
                        <p>3. æµ‹è¯•è¿æ¥ç¡®ä¿é…ç½®æ­£ç¡®</p>
                        <p>4. ç¼–è¾‘å®Œå†…å®¹åç›´æ¥å‘å¸ƒ</p>
                        
                        <h4 style="margin: 20px 0 10px 0;">ğŸ”§ è·å–Token</h4>
                        <p>â€¢ Netlify: <a href="https://app.netlify.com/user/applications" target="_blank">app.netlify.com/user/applications</a></p>
                        <p>â€¢ GitHub: <a href="https://github.com/settings/tokens" target="_blank">github.com/settings/tokens</a></p>
                        <p>â€¢ Vercel: <a href="https://vercel.com/account/tokens" target="_blank">vercel.com/account/tokens</a></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // å…¨å±€çŠ¶æ€
        let adminState = {
            changes: [],
            deployConfig: {},
            isEditing: false,
            currentSection: 'editor'
        };

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            loadConfig();
            loadChanges();
            updateUI();
            setupIframeEditing();
        });

        // æ˜¾ç¤ºä¸åŒéƒ¨åˆ†
        function showEditor() {
            updateNavigation('editor');
            document.getElementById('editor-area').style.display = 'block';
            document.getElementById('deploy-area').style.display = 'none';
            document.getElementById('help-area').style.display = 'none';
            adminState.currentSection = 'editor';
        }

        function showDeploy() {
            updateNavigation('deploy');
            document.getElementById('editor-area').style.display = 'none';
            document.getElementById('deploy-area').style.display = 'block';
            document.getElementById('help-area').style.display = 'none';
            adminState.currentSection = 'deploy';
        }

        function showHelp() {
            updateNavigation('help');
            document.getElementById('editor-area').style.display = 'none';
            document.getElementById('deploy-area').style.display = 'none';
            document.getElementById('help-area').style.display = 'block';
            adminState.currentSection = 'help';
        }

        function updateNavigation(active) {
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });

            const navItems = document.querySelectorAll('.nav-item');
            if (active === 'editor') navItems[0].classList.add('active');
            else if (active === 'deploy') navItems[1].classList.add('active');
            else if (active === 'help') navItems[3].classList.add('active');
        }

        // è®¾ç½®iframeç¼–è¾‘ - ä¿®å¤è·¨åŸŸé—®é¢˜
        function setupIframeEditing() {
            // ä¸ä½¿ç”¨iframeï¼Œç›´æ¥åŠ è½½å†…å®¹åˆ°div
            loadWebsiteContent();
        }

        // åŠ è½½ç½‘ç«™å†…å®¹ - ä½¿ç”¨iframeåŠ è½½çœŸå®ç½‘ç«™
        function loadWebsiteContent() {
            try {
                // åˆ›å»ºiframeæ¥åŠ è½½çœŸå®ç½‘ç«™
                const iframe = document.getElementById('editor-frame');
                iframe.src = '../index.html';
                iframe.style.cssText = `
                    width: 100%;
                    height: 600px;
                    border: 2px solid #e2e8f0;
                    border-radius: 10px;
                    background: white;
                `;

                // ç­‰å¾…iframeåŠ è½½å®Œæˆ
                iframe.onload = function() {
                    try {
                        // è·å–iframeæ–‡æ¡£
                        const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

                        // æ·»åŠ ç¼–è¾‘å™¨æ ·å¼åˆ°iframe
                        const style = iframeDoc.createElement('style');
                        style.textContent = `
                            .editable-element {
                                outline: 2px dashed #667eea !important;
                                cursor: pointer !important;
                                position: relative !important;
                                transition: all 0.3s !important;
                                min-height: 20px !important;
                            }
                            .editable-element:hover {
                                outline-color: #48bb78 !important;
                                background: rgba(72, 187, 120, 0.1) !important;
                            }
                            .editing {
                                outline: 2px solid #ed8936 !important;
                                background: rgba(237, 137, 54, 0.1) !important;
                            }
                            .edit-tooltip {
                                position: absolute;
                                top: -30px;
                                left: 0;
                                background: #2d3748;
                                color: white;
                                padding: 4px 8px;
                                border-radius: 4px;
                                font-size: 12px;
                                z-index: 1000;
                                pointer-events: none;
                            }
                        `;
                        iframeDoc.head.appendChild(style);

                        updateStatus('ready', 'ç½‘ç«™å·²åŠ è½½ï¼Œå¯ä»¥å¼€å§‹ç¼–è¾‘');

                    } catch (error) {
                        console.error('æ— æ³•è®¿é—®iframeå†…å®¹:', error);
                        updateStatus('warning', 'ç½‘ç«™å·²åŠ è½½ï¼Œä½†å¯èƒ½å­˜åœ¨è·¨åŸŸé™åˆ¶');
                    }
                };

                iframe.onerror = function() {
                    updateStatus('error', 'ç½‘ç«™åŠ è½½å¤±è´¥');
                };

            } catch (error) {
                console.error('åŠ è½½ç½‘ç«™å†…å®¹å¤±è´¥:', error);
                updateStatus('error', 'åŠ è½½å¤±è´¥');
                alert('åŠ è½½ç½‘ç«™å†…å®¹å¤±è´¥: ' + error.message);
            }
        }

        // å¼€å§‹ç¼–è¾‘
        function startEditing() {
            if (adminState.isEditing) {
                stopEditing();
                return;
            }

            adminState.isEditing = true;
            updateStatus('editing', 'ç¼–è¾‘æ¨¡å¼å·²å¯ç”¨');

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const editBtn = document.querySelector('[onclick="startEditing()"]');
            editBtn.textContent = 'åœæ­¢ç¼–è¾‘';
            editBtn.style.background = '#f56565';

            try {
                // é¦–å…ˆå°è¯•iframe
                const iframe = document.getElementById('editor-frame');
                if (iframe && iframe.contentDocument) {
                    try {
                        const iframeDoc = iframe.contentDocument;
                        makeElementsEditable(iframeDoc.body);
                        return;
                    } catch (error) {
                        console.log('iframeç¼–è¾‘å¤±è´¥ï¼Œå°è¯•é¢„è§ˆå®¹å™¨:', error);
                    }
                }

                // å›é€€åˆ°é¢„è§ˆå®¹å™¨
                const previewContainer = document.getElementById('preview-container');
                if (previewContainer) {
                    makeElementsEditable(previewContainer);
                    return;
                }

                alert('è¯·å…ˆåŠ è½½ç½‘ç«™å†…å®¹');
                stopEditing();

            } catch (e) {
                alert('æ— æ³•å¯ç”¨ç¼–è¾‘æ¨¡å¼: ' + e.message);
                console.error('ç¼–è¾‘æ¨¡å¼å¯ç”¨å¤±è´¥:', e);
                stopEditing();
            }
        }

        // åœæ­¢ç¼–è¾‘
        function stopEditing() {
            adminState.isEditing = false;
            updateStatus('ready', 'ç¼–è¾‘æ¨¡å¼å·²å…³é—­');

            // æ›´æ–°æŒ‰é’®çŠ¶æ€
            const editBtn = document.querySelector('[onclick="startEditing()"]');
            editBtn.textContent = 'å¼€å§‹ç¼–è¾‘';
            editBtn.style.background = '#667eea';
        }

        // ä½¿å…ƒç´ å¯ç¼–è¾‘çš„é€šç”¨å‡½æ•°
        function makeElementsEditable(container) {
            const textElements = container.querySelectorAll('h1, h2, h3, h4, h5, h6, p, span, a, li, td, th, div');

            let editableCount = 0;
            textElements.forEach(element => {
                // è·³è¿‡åŒ…å«å…¶ä»–å…ƒç´ çš„å®¹å™¨å’Œå·²ç»å¤„ç†çš„å…ƒç´ 
                if (element.children.length === 0 &&
                    element.textContent.trim() &&
                    !element.classList.contains('editable-element')) {

                    element.classList.add('editable-element');
                    element.contentEditable = true;
                    element.setAttribute('data-original', element.textContent.trim());
                    editableCount++;

                    // æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                    addEditingEvents(element);
                }
            });

            if (editableCount > 0) {
                alert(`ç¼–è¾‘æ¨¡å¼å·²å¯ç”¨ï¼\n\nâ€¢ æ‰¾åˆ° ${editableCount} ä¸ªå¯ç¼–è¾‘å…ƒç´ \nâ€¢ é¼ æ ‡æ‚¬åœæŸ¥çœ‹å¯ç¼–è¾‘åŒºåŸŸ\nâ€¢ ç‚¹å‡»æ–‡å­—ç›´æ¥ç¼–è¾‘\nâ€¢ æŒ‰Enteré”®ä¿å­˜ä¿®æ”¹`);
            } else {
                alert('æœªæ‰¾åˆ°å¯ç¼–è¾‘çš„æ–‡æœ¬å…ƒç´ ï¼Œè¯·æ£€æŸ¥é¡µé¢å†…å®¹');
            }
        }

        // æ·»åŠ ç¼–è¾‘äº‹ä»¶çš„å‡½æ•°
        function addEditingEvents(element) {
            // æ·»åŠ æç¤º
            element.addEventListener('mouseenter', function() {
                if (!this.querySelector('.edit-tooltip')) {
                    const tooltip = document.createElement('div');
                    tooltip.className = 'edit-tooltip';
                    tooltip.textContent = 'ç‚¹å‡»ç¼–è¾‘';
                    this.appendChild(tooltip);
                }
            });

            element.addEventListener('mouseleave', function() {
                const tooltip = this.querySelector('.edit-tooltip');
                if (tooltip) tooltip.remove();
            });

            element.addEventListener('focus', function() {
                this.classList.add('editing');
                const tooltip = this.querySelector('.edit-tooltip');
                if (tooltip) tooltip.remove();
            });

            element.addEventListener('blur', function() {
                this.classList.remove('editing');
                recordChange(this);
            });

            element.addEventListener('keydown', function(e) {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    this.blur();
                }
            });

            element.addEventListener('input', function() {
                // å®æ—¶ä¿å­˜ä¿®æ”¹
                recordChange(this);
            });
        }

        // è®°å½•ä¿®æ”¹
        function recordChange(element) {
            const originalText = element.getAttribute('data-original');
            const newText = element.textContent.trim();

            if (originalText !== newText && newText !== '') {
                const change = {
                    id: Date.now(),
                    element: element.tagName.toLowerCase(),
                    selector: getElementSelector(element),
                    oldText: originalText,
                    newText: newText,
                    timestamp: new Date().toISOString()
                };

                // æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨ç›¸åŒå…ƒç´ çš„ä¿®æ”¹
                const existingIndex = adminState.changes.findIndex(c => c.selector === change.selector);
                if (existingIndex !== -1) {
                    adminState.changes[existingIndex] = change;
                } else {
                    adminState.changes.push(change);
                }

                saveChanges();
                updateUI();
                updateStatus('modified', `å·²è®°å½• ${adminState.changes.length} é¡¹ä¿®æ”¹`);

                // è§†è§‰åé¦ˆ
                element.style.background = 'rgba(72, 187, 120, 0.2)';
                setTimeout(() => {
                    element.style.background = '';
                }, 1000);
            }
        }

        // è·å–å…ƒç´ é€‰æ‹©å™¨
        function getElementSelector(element) {
            if (element.id) return '#' + element.id;

            let selector = element.tagName.toLowerCase();
            let parent = element.parentElement;
            let index = Array.from(parent.children).indexOf(element);

            return selector + ':nth-child(' + (index + 1) + ')';
        }

        // å‘å¸ƒæ›´æ–°
        async function publishChanges() {
            if (adminState.changes.length === 0) {
                alert('æ²¡æœ‰ä¿®æ”¹éœ€è¦å‘å¸ƒ');
                return;
            }

            if (!adminState.deployConfig.platform) {
                alert('è¯·å…ˆé…ç½®éƒ¨ç½²è®¾ç½®');
                showDeploy();
                return;
            }

            if (!confirm(`ç¡®å®šè¦å‘å¸ƒ ${adminState.changes.length} é¡¹ä¿®æ”¹å—ï¼Ÿ\n\nä¿®æ”¹å°†éƒ¨ç½²åˆ°: ${getPlatformName(adminState.deployConfig.platform)}`)) {
                return;
            }

            updateStatus('deploying', 'æ­£åœ¨å‘å¸ƒ...');
            showDeployLog();

            try {
                await performDeploy();

                // æ¸…ç©ºä¿®æ”¹è®°å½•
                adminState.changes = [];
                saveChanges();
                updateUI();

                updateStatus('deployed', 'å‘å¸ƒæˆåŠŸï¼');
                addLogLine('success', 'å‘å¸ƒå®Œæˆï¼ç½‘ç«™å·²æ›´æ–°ã€‚');

                setTimeout(() => {
                    if (confirm('å‘å¸ƒæˆåŠŸï¼æ˜¯å¦æ‰“å¼€ç½‘ç«™æŸ¥çœ‹ï¼Ÿ')) {
                        window.open('../index.html', '_blank');
                    }
                    updateStatus('ready', 'å°±ç»ª');
                }, 2000);

            } catch (error) {
                updateStatus('error', 'å‘å¸ƒå¤±è´¥');
                addLogLine('error', 'å‘å¸ƒå¤±è´¥: ' + error.message);
                alert('å‘å¸ƒå¤±è´¥: ' + error.message);
            }
        }

        // æ‰§è¡Œéƒ¨ç½²
        async function performDeploy() {
            addLogLine('info', 'å¼€å§‹å‘å¸ƒæµç¨‹...');
            addLogLine('info', `å¹³å°: ${getPlatformName(adminState.deployConfig.platform)}`);
            addLogLine('info', `ä¿®æ”¹æ•°é‡: ${adminState.changes.length}`);

            let htmlContent = '';

            try {
                // é¦–å…ˆå°è¯•ä»iframeè·å–å†…å®¹
                const iframe = document.getElementById('editor-frame');
                if (iframe && iframe.contentDocument) {
                    addLogLine('info', 'ä»iframeè·å–ç½‘ç«™å†…å®¹...');
                    const iframeDoc = iframe.contentDocument;
                    htmlContent = '<!DOCTYPE html>\n' + iframeDoc.documentElement.outerHTML;
                } else {
                    // å›é€€åˆ°é¢„è§ˆå®¹å™¨
                    const previewContainer = document.getElementById('preview-container');
                    if (previewContainer) {
                        addLogLine('info', 'ä»é¢„è§ˆå®¹å™¨ç”ŸæˆHTML...');
                        htmlContent = `<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CoinMint - æ•°å­—è´§å¸äº¤æ˜“å¹³å°</title>
</head>
<body>
    ${previewContainer.innerHTML}
</body>
</html>`;
                    } else {
                        throw new Error('æ‰¾ä¸åˆ°ç½‘ç«™å†…å®¹');
                    }
                }

                addLogLine('info', 'æ¸…ç†ç¼–è¾‘å™¨æ ·å¼...');

                // æ¸…ç†ç¼–è¾‘å™¨ç›¸å…³çš„ç±»å’Œå±æ€§
                htmlContent = htmlContent.replace(/class="[^"]*editable-element[^"]*"/g, '');
                htmlContent = htmlContent.replace(/class="[^"]*editing[^"]*"/g, '');
                htmlContent = htmlContent.replace(/contenteditable="true"/g, '');
                htmlContent = htmlContent.replace(/data-original="[^"]*"/g, '');
                htmlContent = htmlContent.replace(/<div class="edit-tooltip"[^>]*>.*?<\/div>/g, '');

                // æ¸…ç†ç¼–è¾‘å™¨æ ·å¼
                htmlContent = htmlContent.replace(/\.editable-element[^}]*}/g, '');
                htmlContent = htmlContent.replace(/\.editing[^}]*}/g, '');
                htmlContent = htmlContent.replace(/\.edit-tooltip[^}]*}/g, '');

                addLogLine('success', 'HTMLç”Ÿæˆå®Œæˆ');
                addLogLine('info', `æ­£åœ¨éƒ¨ç½²åˆ° ${getPlatformName(adminState.deployConfig.platform)}...`);

                // æ ¹æ®å¹³å°æ‰§è¡Œéƒ¨ç½²
                if (adminState.deployConfig.platform === 'netlify') {
                    await deployToNetlify(htmlContent);
                } else if (adminState.deployConfig.platform === 'github') {
                    await deployToGitHub(htmlContent);
                } else if (adminState.deployConfig.platform === 'vercel') {
                    await deployToVercel(htmlContent);
                }

                addLogLine('success', 'éƒ¨ç½²å®Œæˆï¼');

            } catch (error) {
                addLogLine('error', 'éƒ¨ç½²å¤±è´¥: ' + error.message);
                throw error;
            }
        }

        // éƒ¨ç½²åˆ°Netlify
        async function deployToNetlify(content) {
            const config = adminState.deployConfig;

            addLogLine('info', 'æ­£åœ¨ä¸Šä¼ åˆ°Netlify...');

            // åˆ›å»ºéƒ¨ç½²åŒ…
            const formData = new FormData();
            const blob = new Blob([content], { type: 'text/html' });
            formData.append('index.html', blob);

            const response = await fetch(`https://api.netlify.com/api/v1/sites/${config.siteId}/deploys`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${config.token}`
                },
                body: formData
            });

            if (!response.ok) {
                const error = await response.text();
                throw new Error(`Netlifyéƒ¨ç½²å¤±è´¥: ${error}`);
            }

            const result = await response.json();
            addLogLine('success', `Netlifyéƒ¨ç½²æˆåŠŸ: ${result.url}`);
        }

        // éƒ¨ç½²åˆ°GitHub
        async function deployToGitHub(content) {
            const config = adminState.deployConfig;

            addLogLine('info', 'æ­£åœ¨æ¨é€åˆ°GitHub...');

            // è·å–å½“å‰æ–‡ä»¶çš„SHA
            const getResponse = await fetch(`https://api.github.com/repos/${config.owner}/${config.repo}/contents/index.html`, {
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            });

            let sha = '';
            if (getResponse.ok) {
                const fileData = await getResponse.json();
                sha = fileData.sha;
            }

            // æ›´æ–°æ–‡ä»¶
            const encodedContent = btoa(unescape(encodeURIComponent(content)));

            const updateResponse = await fetch(`https://api.github.com/repos/${config.owner}/${config.repo}/contents/index.html`, {
                method: 'PUT',
                headers: {
                    'Authorization': `token ${config.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify({
                    message: `Update from CoinMint Admin - ${new Date().toISOString()}`,
                    content: encodedContent,
                    sha: sha
                })
            });

            if (!updateResponse.ok) {
                const error = await updateResponse.text();
                throw new Error(`GitHubéƒ¨ç½²å¤±è´¥: ${error}`);
            }

            addLogLine('success', 'GitHub Pageséƒ¨ç½²æˆåŠŸ');
        }

        // éƒ¨ç½²åˆ°Vercel
        async function deployToVercel(content) {
            const config = adminState.deployConfig;

            addLogLine('info', 'æ­£åœ¨éƒ¨ç½²åˆ°Vercel...');

            // Verceléƒ¨ç½²APIè°ƒç”¨
            const deployData = {
                files: [
                    {
                        file: 'index.html',
                        data: content
                    }
                ],
                projectSettings: {
                    framework: null
                }
            };

            const response = await fetch(`https://api.vercel.com/v13/deployments`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${config.token}`,
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(deployData)
            });

            if (!response.ok) {
                const error = await response.text();
                throw new Error(`Verceléƒ¨ç½²å¤±è´¥: ${error}`);
            }

            const result = await response.json();
            addLogLine('success', `Verceléƒ¨ç½²æˆåŠŸ: ${result.url}`);
        }

        // è¾…åŠ©å‡½æ•°
        function loadConfig() {
            const saved = localStorage.getItem('admin-deploy-config');
            if (saved) {
                adminState.deployConfig = JSON.parse(saved);

                // æ¢å¤é…ç½®è¡¨å•
                if (adminState.deployConfig.platform) {
                    document.getElementById('deploy-platform').value = adminState.deployConfig.platform;
                    updateDeployForm();
                }
            }
        }

        function loadChanges() {
            const saved = localStorage.getItem('admin-changes');
            if (saved) {
                adminState.changes = JSON.parse(saved);
            }
        }

        function saveChanges() {
            localStorage.setItem('admin-changes', JSON.stringify(adminState.changes));
        }

        function updateUI() {
            const changesCount = document.getElementById('changes-count');
            const publishBtn = document.getElementById('publish-btn');
            const previewBtn = document.getElementById('preview-btn');
            const resetBtn = document.getElementById('reset-btn');

            changesCount.textContent = adminState.changes.length;

            const hasChanges = adminState.changes.length > 0;
            publishBtn.disabled = !hasChanges;
            previewBtn.disabled = !hasChanges;
            resetBtn.disabled = !hasChanges;
        }

        function updateStatus(status, message) {
            const dot = document.getElementById('status-dot');
            const text = document.getElementById('status-text');

            dot.className = 'status-dot';
            if (status === 'ready' || status === 'deployed') {
                dot.classList.add('connected');
            } else if (status === 'deploying') {
                dot.classList.add('deploying');
            }

            text.textContent = message;
        }

        function showDeployLog() {
            const log = document.getElementById('deploy-log');
            log.classList.add('show');
            log.innerHTML = '';
        }

        function addLogLine(type, message) {
            const log = document.getElementById('deploy-log');
            const line = document.createElement('div');
            line.className = `log-line log-${type}`;
            line.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            log.appendChild(line);
            log.scrollTop = log.scrollHeight;
        }

        function getPlatformName(platform) {
            const names = {
                'netlify': 'Netlify',
                'github': 'GitHub Pages',
                'vercel': 'Vercel'
            };
            return names[platform] || platform;
        }

        function escapeRegExp(string) {
            return string.replace(/[.*+?^${}()|[\]\\]/g, '\\$&');
        }

        // éƒ¨ç½²é…ç½®ç›¸å…³å‡½æ•°
        function updateDeployForm() {
            const platform = document.getElementById('deploy-platform').value;
            const formContainer = document.getElementById('deploy-form');

            if (!platform) {
                formContainer.innerHTML = '';
                return;
            }

            let formHTML = '';

            if (platform === 'netlify') {
                formHTML = `
                    <div class="form-group">
                        <label>Netlify Access Token</label>
                        <input type="password" id="netlify-token" placeholder="ä» app.netlify.com/user/applications è·å–" value="${adminState.deployConfig.token || ''}">
                    </div>
                    <div class="form-group">
                        <label>Site ID</label>
                        <input type="text" id="netlify-site-id" placeholder="åœ¨Netlifyç«™ç‚¹è®¾ç½®ä¸­æ‰¾åˆ°" value="${adminState.deployConfig.siteId || ''}">
                    </div>
                `;
            } else if (platform === 'github') {
                formHTML = `
                    <div class="form-group">
                        <label>GitHub Token</label>
                        <input type="password" id="github-token" placeholder="ä» github.com/settings/tokens è·å–" value="${adminState.deployConfig.token || ''}">
                    </div>
                    <div class="form-group">
                        <label>ç”¨æˆ·å/ç»„ç»‡</label>
                        <input type="text" id="github-owner" placeholder="GitHubç”¨æˆ·åæˆ–ç»„ç»‡å" value="${adminState.deployConfig.owner || ''}">
                    </div>
                    <div class="form-group">
                        <label>ä»“åº“å</label>
                        <input type="text" id="github-repo" placeholder="ä»“åº“åç§°" value="${adminState.deployConfig.repo || ''}">
                    </div>
                `;
            } else if (platform === 'vercel') {
                formHTML = `
                    <div class="form-group">
                        <label>Vercel Token</label>
                        <input type="password" id="vercel-token" placeholder="ä» vercel.com/account/tokens è·å–" value="${adminState.deployConfig.token || ''}">
                    </div>
                    <div class="form-group">
                        <label>é¡¹ç›®ID</label>
                        <input type="text" id="vercel-project-id" placeholder="åœ¨Vercelé¡¹ç›®è®¾ç½®ä¸­æ‰¾åˆ°" value="${adminState.deployConfig.projectId || ''}">
                    </div>
                `;
            }

            formContainer.innerHTML = formHTML;
        }

        function saveDeployConfig() {
            const platform = document.getElementById('deploy-platform').value;

            if (!platform) {
                alert('è¯·é€‰æ‹©éƒ¨ç½²å¹³å°');
                return;
            }

            const config = { platform };

            if (platform === 'netlify') {
                config.token = document.getElementById('netlify-token').value;
                config.siteId = document.getElementById('netlify-site-id').value;

                if (!config.token || !config.siteId) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„Netlifyé…ç½®ä¿¡æ¯');
                    return;
                }
            } else if (platform === 'github') {
                config.token = document.getElementById('github-token').value;
                config.owner = document.getElementById('github-owner').value;
                config.repo = document.getElementById('github-repo').value;

                if (!config.token || !config.owner || !config.repo) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„GitHubé…ç½®ä¿¡æ¯');
                    return;
                }
            } else if (platform === 'vercel') {
                config.token = document.getElementById('vercel-token').value;
                config.projectId = document.getElementById('vercel-project-id').value;

                if (!config.token || !config.projectId) {
                    alert('è¯·å¡«å†™å®Œæ•´çš„Vercelé…ç½®ä¿¡æ¯');
                    return;
                }
            }

            adminState.deployConfig = config;
            localStorage.setItem('admin-deploy-config', JSON.stringify(config));

            alert('é…ç½®å·²ä¿å­˜ï¼ç°åœ¨å¯ä»¥è¿›è¡Œä¸€é”®å‘å¸ƒäº†ã€‚');
            updateStatus('connected', 'éƒ¨ç½²å·²é…ç½®');
        }

        function testConnection() {
            if (!adminState.deployConfig.platform) {
                alert('è¯·å…ˆä¿å­˜é…ç½®');
                return;
            }

            updateStatus('deploying', 'æµ‹è¯•è¿æ¥ä¸­...');

            // ç®€å•çš„è¿æ¥æµ‹è¯•
            setTimeout(() => {
                updateStatus('connected', 'è¿æ¥æµ‹è¯•æˆåŠŸ');
                alert('è¿æ¥æµ‹è¯•æˆåŠŸï¼å¯ä»¥è¿›è¡Œéƒ¨ç½²äº†ã€‚');
            }, 2000);
        }

        function previewChanges() {
            if (adminState.changes.length === 0) {
                alert('æ²¡æœ‰ä¿®æ”¹å¯é¢„è§ˆ');
                return;
            }

            const preview = adminState.changes.map((change, index) =>
                `${index + 1}. ${change.element.toUpperCase()}: "${change.oldText}" â†’ "${change.newText}"`
            ).join('\n\n');

            alert(`ä¿®æ”¹é¢„è§ˆ (${adminState.changes.length} é¡¹):\n\n${preview}`);
        }

        function resetChanges() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ‰€æœ‰ä¿®æ”¹å—ï¼Ÿ')) {
                adminState.changes = [];
                saveChanges();
                updateUI();

                // é‡æ–°åŠ è½½å†…å®¹
                loadWebsiteContent();

                updateStatus('ready', 'ä¿®æ”¹å·²é‡ç½®');
                alert('æ‰€æœ‰ä¿®æ”¹å·²é‡ç½®ï¼');
            }
        }
    </script>
</body>
=======
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Netlify CMS</title>
  </head>
  <body>
    <!-- CMS æŒ‚è½½ç‚¹ -->
    <div id="nc-root"></div>

    <!-- Netlify Identity Widget -->
    <script src="https://identity.netlify.com/v1/netlify-identity-widget.js"></script>
    <!-- Netlify CMS -->
    <script src="https://unpkg.com/netlify-cms@^2.0.0/dist/netlify-cms.js"></script>
  </body>
>>>>>>> 57291d257af4a9bcccf5d0fab0d80804e2a86d1f
</html>
