<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éƒ¨ç½²è¯Šæ–­å·¥å…· - CoinMint</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .content {
            padding: 40px;
        }

        .diagnostic-section {
            margin-bottom: 30px;
            padding: 25px;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            background: #f9fafb;
        }

        .diagnostic-section h3 {
            color: #374151;
            margin-bottom: 15px;
            font-size: 1.3em;
        }

        .status-item {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
            padding: 10px;
            background: white;
            border-radius: 8px;
            border-left: 4px solid #e5e7eb;
        }

        .status-item.success {
            border-left-color: #10b981;
        }

        .status-item.error {
            border-left-color: #ef4444;
        }

        .status-item.warning {
            border-left-color: #f59e0b;
        }

        .status-icon {
            font-size: 1.2em;
            margin-right: 10px;
            width: 25px;
        }

        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin: 10px 5px;
            transition: transform 0.2s;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn.secondary {
            background: #6b7280;
        }

        .config-form {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-top: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 600;
            color: #374151;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 1em;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .help-text {
            font-size: 0.9em;
            color: #6b7280;
            margin-top: 5px;
        }

        .test-results {
            margin-top: 20px;
            padding: 20px;
            background: #f3f4f6;
            border-radius: 10px;
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ”§ éƒ¨ç½²è¯Šæ–­å·¥å…·</h1>
            <p>æ£€æµ‹å’Œè§£å†³ä¸€é”®éƒ¨ç½²ç¼–è¾‘å™¨çš„é—®é¢˜</p>
        </div>

        <div class="content">
            <!-- å½“å‰çŠ¶æ€æ£€æŸ¥ -->
            <div class="diagnostic-section">
                <h3>ğŸ“Š å½“å‰çŠ¶æ€æ£€æŸ¥</h3>
                <div id="status-checks">
                    <div class="status-item" id="config-status">
                        <span class="status-icon">â³</span>
                        <span>æ­£åœ¨æ£€æŸ¥é…ç½®...</span>
                    </div>
                    <div class="status-item" id="github-status">
                        <span class="status-icon">â³</span>
                        <span>æ­£åœ¨æ£€æŸ¥GitHubè¿æ¥...</span>
                    </div>
                    <div class="status-item" id="netlify-status">
                        <span class="status-icon">â³</span>
                        <span>æ­£åœ¨æ£€æŸ¥Netlifyè¿æ¥...</span>
                    </div>
                </div>
                <button class="btn" onclick="runDiagnostics()">ğŸ”„ é‡æ–°æ£€æŸ¥</button>
            </div>

            <!-- é…ç½®ç®¡ç† -->
            <div class="diagnostic-section">
                <h3>âš™ï¸ é…ç½®ç®¡ç†</h3>
                <button class="btn" onclick="showConfig()">ğŸ“ æŸ¥çœ‹/ç¼–è¾‘é…ç½®</button>
                <button class="btn secondary" onclick="clearConfig()">ğŸ—‘ï¸ æ¸…é™¤é…ç½®</button>
                <button class="btn secondary" onclick="exportConfig()">ğŸ“¤ å¯¼å‡ºé…ç½®</button>
                <button class="btn secondary" onclick="importConfig()">ğŸ“¥ å¯¼å…¥é…ç½®</button>
                
                <div id="config-form" class="config-form hidden">
                    <h4>éƒ¨ç½²é…ç½®</h4>
                    <div class="form-group">
                        <label>GitHub Token:</label>
                        <input type="password" id="github-token" placeholder="ghp_xxxxxxxxxxxx">
                        <div class="help-text">åœ¨GitHub Settings > Developer settings > Personal access tokensç”Ÿæˆ</div>
                    </div>
                    <div class="form-group">
                        <label>GitHubç”¨æˆ·å:</label>
                        <input type="text" id="github-owner" placeholder="your-username">
                    </div>
                    <div class="form-group">
                        <label>GitHubä»“åº“å:</label>
                        <input type="text" id="github-repo" placeholder="your-repo-name">
                    </div>
                    <div class="form-group">
                        <label>GitHubåˆ†æ”¯:</label>
                        <input type="text" id="github-branch" placeholder="main" value="main">
                    </div>
                    <div class="form-group">
                        <label>Netlify Token (å¯é€‰):</label>
                        <input type="password" id="netlify-token" placeholder="nfp_xxxxxxxxxxxx">
                    </div>
                    <div class="form-group">
                        <label>Netlify Site ID (å¯é€‰):</label>
                        <input type="text" id="netlify-site-id" placeholder="xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx">
                    </div>
                    <button class="btn" onclick="saveConfig()">ğŸ’¾ ä¿å­˜é…ç½®</button>
                    <button class="btn secondary" onclick="testConfig()">ğŸ§ª æµ‹è¯•é…ç½®</button>
                </div>
            </div>

            <!-- æµ‹è¯•ç»“æœ -->
            <div id="test-results" class="test-results hidden">
                <h4>ğŸ§ª æµ‹è¯•ç»“æœ</h4>
                <div id="test-output"></div>
            </div>

            <!-- å¸¸è§é—®é¢˜ -->
            <div class="diagnostic-section">
                <h3>â“ å¸¸è§é—®é¢˜è§£å†³</h3>
                <div class="status-item">
                    <span class="status-icon">ğŸ”‘</span>
                    <div>
                        <strong>Tokenæƒé™é—®é¢˜:</strong><br>
                        ç¡®ä¿GitHub Tokenæœ‰repoæƒé™ï¼ŒNetlify Tokenæœ‰site:writeæƒé™
                    </div>
                </div>
                <div class="status-item">
                    <span class="status-icon">ğŸŒ</span>
                    <div>
                        <strong>ç½‘ç»œè¿æ¥é—®é¢˜:</strong><br>
                        æ£€æŸ¥ç½‘ç»œè¿æ¥ï¼Œç¡®ä¿å¯ä»¥è®¿é—®GitHubå’ŒNetlify API
                    </div>
                </div>
                <div class="status-item">
                    <span class="status-icon">ğŸ“</span>
                    <div>
                        <strong>é…ç½®é”™è¯¯:</strong><br>
                        æ£€æŸ¥ä»“åº“åç§°ã€åˆ†æ”¯åç§°ã€Site IDæ˜¯å¦æ­£ç¡®
                    </div>
                </div>
                <div class="status-item">
                    <span class="status-icon">â°</span>
                    <div>
                        <strong>Tokenè¿‡æœŸ:</strong><br>
                        é‡æ–°ç”ŸæˆTokenå¹¶æ›´æ–°é…ç½®
                    </div>
                </div>
            </div>

            <!-- æ“ä½œæŒ‰é’® -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn" onclick="window.location.href='../index.html'">ğŸ  è¿”å›ä¸»é¡µ</button>
                <button class="btn secondary" onclick="window.location.href='one-click-editor.html'">âœï¸ æ‰“å¼€ç¼–è¾‘å™¨</button>
            </div>
        </div>
    </div>

    <script>
        // ä»localStorageè·å–é…ç½®
        function getConfig() {
            const config = localStorage.getItem('oneclick-deploy-config');
            return config ? JSON.parse(config) : {};
        }

        // ä¿å­˜é…ç½®åˆ°localStorage
        function saveConfigToStorage(config) {
            localStorage.setItem('oneclick-deploy-config', JSON.stringify(config));
        }

        // è¿è¡Œè¯Šæ–­
        async function runDiagnostics() {
            const config = getConfig();
            
            // æ£€æŸ¥é…ç½®
            checkConfig(config);
            
            // æ£€æŸ¥GitHubè¿æ¥
            await checkGitHubConnection(config);
            
            // æ£€æŸ¥Netlifyè¿æ¥
            await checkNetlifyConnection(config);
        }

        // æ£€æŸ¥é…ç½®
        function checkConfig(config) {
            const statusEl = document.getElementById('config-status');
            
            if (!config.githubToken && !config.netlifyToken) {
                updateStatus(statusEl, 'error', 'âŒ', 'æœªé…ç½®ä»»ä½•éƒ¨ç½²æ–¹å¼');
            } else if (config.githubToken && config.githubOwner && config.githubRepo) {
                updateStatus(statusEl, 'success', 'âœ…', 'GitHubé…ç½®å®Œæ•´');
            } else if (config.netlifyToken && config.siteId) {
                updateStatus(statusEl, 'success', 'âœ…', 'Netlifyé…ç½®å®Œæ•´');
            } else {
                updateStatus(statusEl, 'warning', 'âš ï¸', 'é…ç½®ä¸å®Œæ•´');
            }
        }

        // æ£€æŸ¥GitHubè¿æ¥
        async function checkGitHubConnection(config) {
            const statusEl = document.getElementById('github-status');
            
            if (!config.githubToken) {
                updateStatus(statusEl, 'warning', 'âš ï¸', 'GitHubæœªé…ç½®');
                return;
            }
            
            try {
                const response = await fetch('https://api.github.com/user', {
                    headers: {
                        'Authorization': `token ${config.githubToken}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    updateStatus(statusEl, 'success', 'âœ…', `GitHubè¿æ¥æˆåŠŸ (${user.login})`);
                } else {
                    updateStatus(statusEl, 'error', 'âŒ', `GitHubè¿æ¥å¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                updateStatus(statusEl, 'error', 'âŒ', `GitHubè¿æ¥é”™è¯¯: ${error.message}`);
            }
        }

        // æ£€æŸ¥Netlifyè¿æ¥
        async function checkNetlifyConnection(config) {
            const statusEl = document.getElementById('netlify-status');
            
            if (!config.netlifyToken) {
                updateStatus(statusEl, 'warning', 'âš ï¸', 'Netlifyæœªé…ç½®');
                return;
            }
            
            try {
                const response = await fetch('https://api.netlify.com/api/v1/user', {
                    headers: {
                        'Authorization': `Bearer ${config.netlifyToken}`
                    }
                });
                
                if (response.ok) {
                    const user = await response.json();
                    updateStatus(statusEl, 'success', 'âœ…', `Netlifyè¿æ¥æˆåŠŸ (${user.email})`);
                } else {
                    updateStatus(statusEl, 'error', 'âŒ', `Netlifyè¿æ¥å¤±è´¥: ${response.status}`);
                }
            } catch (error) {
                updateStatus(statusEl, 'error', 'âŒ', `Netlifyè¿æ¥é”™è¯¯: ${error.message}`);
            }
        }

        // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
        function updateStatus(element, type, icon, text) {
            element.className = `status-item ${type}`;
            element.innerHTML = `<span class="status-icon">${icon}</span><span>${text}</span>`;
        }

        // æ˜¾ç¤ºé…ç½®è¡¨å•
        function showConfig() {
            const form = document.getElementById('config-form');
            const config = getConfig();
            
            // å¡«å……è¡¨å•
            document.getElementById('github-token').value = config.githubToken || '';
            document.getElementById('github-owner').value = config.githubOwner || '';
            document.getElementById('github-repo').value = config.githubRepo || '';
            document.getElementById('github-branch').value = config.githubBranch || 'main';
            document.getElementById('netlify-token').value = config.netlifyToken || '';
            document.getElementById('netlify-site-id').value = config.siteId || '';
            
            form.classList.toggle('hidden');
        }

        // ä¿å­˜é…ç½®
        function saveConfig() {
            const config = {
                githubToken: document.getElementById('github-token').value,
                githubOwner: document.getElementById('github-owner').value,
                githubRepo: document.getElementById('github-repo').value,
                githubBranch: document.getElementById('github-branch').value || 'main',
                netlifyToken: document.getElementById('netlify-token').value,
                siteId: document.getElementById('netlify-site-id').value
            };
            
            saveConfigToStorage(config);
            alert('é…ç½®å·²ä¿å­˜ï¼');
            runDiagnostics();
        }

        // æµ‹è¯•é…ç½®
        async function testConfig() {
            const resultsEl = document.getElementById('test-results');
            const outputEl = document.getElementById('test-output');
            
            resultsEl.classList.remove('hidden');
            outputEl.innerHTML = '<div class="loading"></div> æ­£åœ¨æµ‹è¯•é…ç½®...';
            
            const config = {
                githubToken: document.getElementById('github-token').value,
                githubOwner: document.getElementById('github-owner').value,
                githubRepo: document.getElementById('github-repo').value,
                githubBranch: document.getElementById('github-branch').value || 'main',
                netlifyToken: document.getElementById('netlify-token').value,
                siteId: document.getElementById('netlify-site-id').value
            };
            
            let results = [];
            
            // æµ‹è¯•GitHub
            if (config.githubToken) {
                try {
                    const response = await fetch('https://api.github.com/user', {
                        headers: {
                            'Authorization': `token ${config.githubToken}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (response.ok) {
                        results.push('âœ… GitHub Tokenæœ‰æ•ˆ');
                        
                        // æµ‹è¯•ä»“åº“è®¿é—®
                        if (config.githubOwner && config.githubRepo) {
                            const repoResponse = await fetch(`https://api.github.com/repos/${config.githubOwner}/${config.githubRepo}`, {
                                headers: {
                                    'Authorization': `token ${config.githubToken}`,
                                    'Accept': 'application/vnd.github.v3+json'
                                }
                            });
                            
                            if (repoResponse.ok) {
                                results.push('âœ… ä»“åº“è®¿é—®æ­£å¸¸');
                            } else {
                                results.push('âŒ ä»“åº“è®¿é—®å¤±è´¥');
                            }
                        }
                    } else {
                        results.push('âŒ GitHub Tokenæ— æ•ˆ');
                    }
                } catch (error) {
                    results.push(`âŒ GitHubæµ‹è¯•å¤±è´¥: ${error.message}`);
                }
            }
            
            // æµ‹è¯•Netlify
            if (config.netlifyToken) {
                try {
                    const response = await fetch('https://api.netlify.com/api/v1/user', {
                        headers: {
                            'Authorization': `Bearer ${config.netlifyToken}`
                        }
                    });
                    
                    if (response.ok) {
                        results.push('âœ… Netlify Tokenæœ‰æ•ˆ');
                    } else {
                        results.push('âŒ Netlify Tokenæ— æ•ˆ');
                    }
                } catch (error) {
                    results.push(`âŒ Netlifyæµ‹è¯•å¤±è´¥: ${error.message}`);
                }
            }
            
            outputEl.innerHTML = results.join('<br>');
        }

        // æ¸…é™¤é…ç½®
        function clearConfig() {
            if (confirm('ç¡®å®šè¦æ¸…é™¤æ‰€æœ‰é…ç½®å—ï¼Ÿ')) {
                localStorage.removeItem('oneclick-deploy-config');
                alert('é…ç½®å·²æ¸…é™¤ï¼');
                runDiagnostics();
            }
        }

        // å¯¼å‡ºé…ç½®
        function exportConfig() {
            const config = getConfig();
            const dataStr = JSON.stringify(config, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = 'deploy-config.json';
            link.click();
        }

        // å¯¼å…¥é…ç½®
        function importConfig() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        try {
                            const config = JSON.parse(e.target.result);
                            saveConfigToStorage(config);
                            alert('é…ç½®å¯¼å…¥æˆåŠŸï¼');
                            runDiagnostics();
                        } catch (error) {
                            alert('é…ç½®æ–‡ä»¶æ ¼å¼é”™è¯¯ï¼');
                        }
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        // é¡µé¢åŠ è½½æ—¶è¿è¡Œè¯Šæ–­
        document.addEventListener('DOMContentLoaded', runDiagnostics);
    </script>
</body>
</html>
